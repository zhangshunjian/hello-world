kind: pipeline # å®šä¹‰ä¸€ä¸ªç®¡é“
type: docker # å®šä¹‰ç®¡é“ç±»åž‹
name: build # å®šä¹‰ç®¡é“åç§°

clone:
  disable: false # å¯ç”¨ä»£ç æ‹‰å–

steps:
  - name: build-project # æ­¥éª¤åç§°
    image: node:16.13.2 # ä½¿ç”¨é•œåƒ
    depends_on: [clone] # ä¾èµ–çš„æ­¥éª¤ï¼Œ
    commands: #æ‰§è¡Œå‘½ä»¤
      - npm config set registry https://registry.npm.taobao.org # åˆ‡æ¢æ·˜å®é•œåƒ
      - npm install # å®‰è£…node_modulesåŒ…
      - npm run build # æ‰§è¡Œç¼–è¯‘

  - name: notify
    image: fifsky/drone-wechat-work
    pull: always
    settings:
      url: https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=43d424c0-3581-4e26-a9a3-c985ac48e31b
      msgtype: markdown
      content: |
        {{if eq .Status "success" }}
        #### ðŸŽ‰ ${DRONE_REPO} æž„å»ºæˆåŠŸ
        > Commit: [${DRONE_COMMIT_MESSAGE}](${DRONE_COMMIT_LINK})
        > Author: ${DRONE_COMMIT_AUTHOR}
        > [ç‚¹å‡»æŸ¥çœ‹](${DRONE_BUILD_LINK})
        {{else}}
        #### âŒ ${DRONE_REPO} æž„å»ºå¤±è´¥
        > Commit: [${DRONE_COMMIT_MESSAGE}](${DRONE_COMMIT_LINK})
        > Author: ${DRONE_COMMIT_AUTHOR}
        > è¯·ç«‹å³ä¿®å¤!!!
        > [ç‚¹å‡»æŸ¥çœ‹](${DRONE_BUILD_LINK})
        {{end}}
    when:
      status:
        - failure
        - success
